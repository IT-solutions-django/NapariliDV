{% extends 'base.html' %}
{% load static %}

{% block title %}Галерея - Напарили ДВ{% endblock %}

{% block content %}
<div class="breadcrumbs container font__inter">
    <div>
        <a href="{% url 'home:home' %}">Главная</a>
    </div>
    <div>
        <img src="{% static 'images/right-gray-arrow.svg' %}" alt="">
    </div>
    <div>
        <a href="{% url 'contacts:gallery' %}">Галерея</a>
    </div>
</div>
<div class="gallery-page">
    <div class="news-page__header container">
        <div class="news__heading">
            <h1>Галерея</h1>
        </div>
        <hr class="news-page__header-hr--adaptive">
        <div class="news__header-right-buttons">
            <form id="galleryForm" action="{% url 'blog:blog' %}">
                {% for category in filter_form.category %}
                    <div class="news__header-button">
                        {{ choice.tag }}
                        <input 
                            type="radio"
                            name="{{ category.data.name }}" 
                            value="{{ category.data.value }}"
                            class="radio-toggle"
                            id="{{ category.id_for_label }}" 
                            {% if category.data.selected %}checked data-was-checked="true"{% endif %}
                        >
                        <label for="{{ category.id_for_label }}">{{ category.choice_label }}</label>
                    </div>
                {% endfor %}
            </form>
        </div>
    </div>
    <hr class="news-page__header-hr container">
    <div class="container">
        <div class="article__content">
            <div class="article__content-block">
                <div class="article__paragraph">
                    <div class="article__paragraph-heading">
                        Внезапно, герцог графства коронован
                    </div>
                    <div class="article__paragraph-text font__inter">
                        Однозначно, сторонники тоталитаризма в науке заблокированы в рамках своих собственных рациональных ограничений. Кстати, акционеры крупнейших компаний призывают нас к новым свершениям, которые, в свою очередь, должны быть объявлены нарушающими общечеловеческие нормы этики и морали! Предварительные выводы неутешительны: глубокий уровень погружения однозначно фиксирует необходимость позиций, занимаемых участниками в отношении поставленных задач
        Каркасный дом - это дом, в основе которого есть несущий деревянный каркас. Он в свою очередь заполняется современными материалами для влаго-, ветро- и теплозащиты: Изоспан А, изоспин В, утеплитель Технониколь, и обшивается отделочными материалами (панели «Доке, имитация бруса, Данил «Ханья»). По завершении работ стена каркасного дома напоминает слоеный пиро
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="gallery-page__slider">
        {% for project in gallery_photos %}
            <div class="gallery-page__photo">
                <img src="{{ project.gallery_photo.url }}" alt="">
            </div>
        {% endfor %}
    </div>
    
</div>

<div class="about">
    <div class="contacts container">
        <div class="contacts__small-left-column">
            <div class="contacts__heading">
                <h4>Контакты</h4>
            </div>
            <div class="contacts__info">
                <div class="contacts__block">
                    <div>
                        <img src="{% static 'images/contacts-icon-1.svg' %}" alt="">
                    </div>
                    <div>
                        <div class="contacts__block-heading">
                            <a href="{{ company_info.two_gis_profile }}">Главный офис:</a>
                        </div>
                        <div class="font__inter">
                            <a href="{{ company_info.two_gis_profile }}" class="font__inter">{{ company_info.address }}</a>
                        </div>
                    </div>
                </div>
                <div class="contacts__block">
                    <div>
                        <img src="{% static 'images/contacts-icon-2.svg' %}" alt="">
                    </div>
                    <div>
                        <div class="contacts__block-heading">
                            <p>Время работы:</p>
                        </div>
                        <div class="font__inter">
                            <p>{{ company_info.working_mode }}</p>
                        </div>
                    </div>
                </div>
                <div class="contacts__block">
                    <div>
                        <img src="{% static 'images/contacts-icon-3.svg' %}" alt="">
                    </div>
                    <div>
                        <div class="contacts__block-heading">
                            <a href="tel:{{ company_info.phone }}">Телефон:</a>
                        </div>
                        <div class="font__inter">
                            <a href="tel:{{ company_info.phone }}" class="font__inter">{{ company_info.phone }}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="contacts__big-right-column">
            <div class="map" id="map">

            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block script %}
<script>
$(document).ready(function () {
        $('.gallery-page__slider').slick({
            centerMode: true,
            arrows: true,
            infinite: true,
            slidesToShow: 1.7,
            slidesToScroll: 1,

            responsive: [, 
                {
                    breakpoint: 1600, 
                    settings: {
                        slidesToShow: 1.6, 
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 1024, 
                    settings: {
                        slidesToShow: 1, 
                        slidesToScroll: 1
                    }
                },
            ]
        });
    });

var myMap;
ymaps.ready(function(){
    myMap = new ymaps.Map("map", {
        center: [43.157062, 131.926061], 
        zoom: 16, 
        controls: []
    });
    var o = new ymaps.control.ZoomControl({
          options: {
              position: {
                  right: 10,
                  top: 50
              },
              size: "small"
          }
      });
    myMap.controls.add(o);
    myMap.behaviors.disable("scrollZoom");
    var s = new ymaps.Placemark([43.157062, 131.926061], {
              hintContent: "Волгоградская улица, 7А",
              balloonContent: "Волгоградская улица, 7А"
          }, {
              iconLayout: "default#image",
              iconImageHref: `/static/images/pin.svg`,
              iconImageSize: [50, 50],
              iconImageOffset: [-15, -42]
          });
    myMap.geoObjects.add(s);
}); 
</script>

<script>
    // Фильтрация фотографий в галерее
    $(document).ready(function() {
        $('#galleryForm input').on('change input', function(event) {
            let formData = $('#galleryForm').serialize();
            let gallerySliderContainer = $('.gallery-page__slider');
            console.log(gallerySliderContainer)
    
            let timeout = setTimeout(function () {
                $.ajax({
                    url: "{% url 'contacts:gallery_filters' %}",  
                    type: "GET",
                    data: formData,
                    success: function(response) {
                        $('.gallery-page__slider').replaceWith(response.html);
                        console.log(response.html)

                        // Инициализация слайдера
                        $(document).ready(function () {
                            $('.gallery-page__slider').slick({
                                centerMode: true,
                                arrows: true,
                                infinite: true,
                                slidesToShow: 1.7,
                                slidesToScroll: 1,
                                responsive: [, 
                                    {
                                        breakpoint: 1600, 
                                        settings: {
                                            slidesToShow: 1.6, 
                                            slidesToScroll: 1
                                        }
                                    },
                                    {
                                        breakpoint: 1024, 
                                        settings: {
                                            slidesToShow: 1, 
                                            slidesToScroll: 1
                                        }
                                    },
                                ]
                            });
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка при фильтрации:", error);
                    }
                });
            }, 200);      
        });
    });
    </script> 
<script>
    // Сброс input radio
    document.addEventListener("DOMContentLoaded", function () {
    const radioButtons = document.querySelectorAll('.radio-toggle');

    radioButtons.forEach(function (radio) {
        radio.addEventListener('click', function () {
            if (this.dataset.wasChecked === "true") {
                this.checked = false;
                this.dataset.wasChecked = "false";
            } else {
                this.dataset.wasChecked = "true";
            }

            radioButtons.forEach(function (otherRadio) {
                if (otherRadio !== radio && otherRadio.name == radio.name) {
                    otherRadio.dataset.wasChecked = "false";
                }
            });

            // Применение новых фильтров
            let formData = $('#galleryForm').serialize();
            let gallerySliderContainer = $('.gallery-page__slider');

            timeout = setTimeout(function () {
                $.ajax({
                    url: "{% url 'contacts:gallery_filters' %}",  
                    type: "GET",
                    data: formData,
                    success: function(response) {
                        gallerySliderContainer.replaceWith(response.html);

                        // Инициализация слайдера
                        $(document).ready(function () {
                            $('.gallery-page__slider').slick({
                                centerMode: true,
                                arrows: true,
                                infinite: true,
                                slidesToShow: 1.7,
                                slidesToScroll: 1,
                                responsive: [, 
                                    {
                                        breakpoint: 1600, 
                                        settings: {
                                            slidesToShow: 1.6, 
                                            slidesToScroll: 1
                                        }
                                    },
                                    {
                                        breakpoint: 1024, 
                                        settings: {
                                            slidesToShow: 1, 
                                            slidesToScroll: 1
                                        }
                                    },
                                ]
                            });
                        });
                        
                    },
                    error: function(xhr, status, error) {
                        console.error("Ошибка при фильтрации:", error);
                    }
                });
            }, 200);
        });
    });
});
</script>
{% endblock %}